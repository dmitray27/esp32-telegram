<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã ESP32</title>
    <style>
        :root {
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --bg-primary: #f7fafc;
            --accent: #4299e1;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            width: min(90%, 400px);
        }

        h1 {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 300;
            margin: 0 0 1.5rem;
            line-height: 1.5;
            text-align: left;
        }

        .parameters-title {
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-weight: 500;
            text-align: left;
        }

        .parameters-block {
            margin: 1rem 0;
            text-align: left;
        }

        .param {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
            line-height: 1.6;
        }

        .meta-info {
            margin-top: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-align: left;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.3rem 0;
        }

        /* –î–æ–±–∞–≤–ª–µ–Ω–æ –∂–∏—Ä–Ω–æ–µ –Ω–∞—á–µ—Ä—Ç–∞–Ω–∏–µ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        .meta-info .meta-item:first-child {
            font-weight: 700;
            color: var(--text-primary);
        }

        .error {
            color: #e53e3e;
            padding: 1rem;
            background: #fff5f5;
            border-radius: 0.5rem;
            margin: 1rem 0;
            text-align: left;
        }

        .refresh-indicator {
            height: 3px;
            background: var(--accent);
            width: 0%;
            transition: width 5s linear;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            –Ø ‚Äî –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ESP32, —à–ª—é –ø—Ä–∏–≤–µ—Ç –æ—Ç –î–º–∏—Ç—Ä–∏—è –∏ —Å–ª–µ–∂—É –∑–∞ —Å–≤–æ–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –î–º–∏—Ç—Ä–∏–π –Ω–∞—É—á–∏–ª –º–µ–Ω—è —Å—á–∏—Ç—ã–≤–∞—Ç—å —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Ä–∞–∑–º–µ—â–∞—Ç—å –∏—Ö –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. üôÇ –ß—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –±—ã—Å—Ç—Ä–æ –∏ –±—ã–ª–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ, –î–º–∏—Ç—Ä–∏—é –ø—Ä–∏—à–ª–æ—Å—å –ø–æ—Å–µ–ª–∏—Ç—å –º–µ–Ω—è –Ω–∞ –ø–ª–∞—Ç–Ω–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ. –ó–∞ –º–æ—ë –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ –ø–æ —ç—Ç–æ–º—É –≤–µ–±-–∞–¥—Ä–µ—Å—É –î–º–∏—Ç—Ä–∏–π –ø–ª–∞—Ç–∏—Ç, –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç, 355 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü. üò¢

        </h1>

        <div id="content">
            {% if data.error %}
                <div class="error">{{ data.error }}</div>
            {% else %}
                <div class="parameters-block">
                    <div class="parameters-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ ESP32:</div>
                    
                    <div class="param">
                        üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {{ data.temperature }}¬∞–°
                    </div>
                    <div class="param">
                        üîã –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è: {{ data.voltage }} –í
                    </div>
                    <div class="param">
                        üíæ –°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å: {{ data.free_heap }} –±–∞–π—Ç
                    </div>
                    <div class="param">
                        „Ä∞Ô∏è –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞: {{ data.cpu_freq }} –ú–ì—Ü
                    </div>
                    <div class="param">
                        üì∂ –£—Ä–æ–≤–µ–Ω—å Wi-Fi: {{ data.wifi_rssi }} dBm
                    </div>
                    <div class="param">
                        ‚è≥ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: {{ data.uptime }}
                    </div>
                </div>

                <div class="meta-info">
                    <div class="meta-item">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</div>
                    <div class="meta-item">
                        <span>üìÖ</span>
                        {{ data.date }}
                    </div>
                    <div class="meta-item">
                        <span>üïí</span>
                        {{ data.time }}
                    </div>
                </div>
            {% endif %}
        </div>
        <div class="refresh-indicator" id="refreshIndicator"></div>
    </div>

    <script>
        async function refreshData() {
            try {
                const indicator = document.getElementById('refreshIndicator');
                indicator.style.width = '100%';

                const response = await fetch(window.location.href, {
                    headers: { 'Cache-Control': 'no-cache' }
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const html = await response.text();
                const parser = new DOMParser();
                const newDoc = parser.parseFromString(html, 'text/html');
                const newContent = newDoc.getElementById('content').innerHTML;
                document.getElementById('content').innerHTML = newContent;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
            } finally {
                indicator.style.width = '0%';
            }
        }

        setInterval(refreshData, 5000);
        setTimeout(refreshData, 100);
    </script>
</body>
</html>
